### 一、建立模型


```python
# 输入参数
num_molecules1 = 20  # 第一种分子的数量
num_molecules2 = 20  # 第二种分子的数量
density = 3.0        # mol/L -r
distance = 2.5       # 分子间距 -t
file_path1 = "./data/c4c1im.zmat"  # 第一个文件的路径
file_path2 = "./data/ntf2.zmat"   # 第二个文件的路径

# 构建命令 build a simulation box with x and y molecules and a density of densiy mol/L
command = f"fftool {num_molecules1} {file_path1} {num_molecules2} {file_path2} -r {density}"

# 在 Jupyter Notebook 中执行命令fftool
!{command}

# 用packmol建模
import os

# Add the path of Packmol
#os.environ['PATH'] -= os.pathsep + '/opt/gengzi/pub/softwares/Packmol/packmol-20.3.5'

# Use packmol with the pack.inp file
!packmol < pack.inp >> output.txt
```

    density 3.000 mol/L  volume 22141.0 A^3
    molecule_file      species           nmol force_field      nbond source  charge
      ./data/c4c1im.zmat c4c1im+             20 il.ff               25 file   +1.0000
      ./data/ntf2.zmat tf2N-               20 il.ff               14 file   -1.0000
    packmol file
      pack.inp


### 二、可视化模型


```python
import subprocess
import os
import tempfile

def format_and_convert_zmatrix(input_file_path, xyz_file_path):
    # 读取并格式化 Z-matrix
    with open(input_file_path, 'r') as file:
        lines = file.readlines()

    formatted_lines = []
    for line in lines:
        parts = line.split()
        if parts and parts[0].isdigit():
            formatted_line = parts[1][0] + ' ' + ' '.join(parts[2:])
            formatted_lines.append(formatted_line)

    # 将格式化后的数据保存到临时文件中
    with tempfile.NamedTemporaryFile(delete=False, mode='w', suffix='.zmat') as temp_file:
        temp_file.writelines('\n'.join(formatted_lines))
        temp_file_path = temp_file.name

    # 转换格式化后的 Z-matrix 到 XYZ 格式
    with open(xyz_file_path, 'w') as xyz_file:
        subprocess.run(
            ["python", "/home/tanshendong/soft/geomConvert-master/gc.py", "-zmat", temp_file_path],
            stdout=xyz_file
        )

    # 删除临时文件
    os.remove(temp_file_path)

# 输入文件和 XYZ 文件路径
input_file_path_1 = './data/c4c1im.zmat'
input_file_path_2 = './data/ntf2.zmat'
xyz_file_path_1 = 'new_c4c1im.xyz'
xyz_file_path_2 = 'new_ntf2.xyz'

# 调用函数处理文件并转换格式
format_and_convert_zmatrix(input_file_path_1, xyz_file_path_1)
format_and_convert_zmatrix(input_file_path_2, xyz_file_path_2)
print("Conversion to XYZ format is complete.")
```

    Conversion to XYZ format is complete.



```python
from openbabel import pybel
from rdkit import Chem
from rdkit.Chem import Draw, AllChem
from IPython.display import display
import ipywidgets as widgets
import io

def visualize_molecule_from_xyz(xyz_filename):
    # 使用 Open Babel 从 XYZ 文件读取分子
    mol = next(pybel.readfile("xyz", xyz_filename))

    # 将分子转换为 SMILES
    smiles = mol.write("smi")

    # 使用 RDKit 从 SMILES 创建分子
    rdkit_mol = Chem.MolFromSmiles(smiles.strip())

    # 对分子进行二维坐标生成
    rdkit_mol = Chem.AddHs(rdkit_mol)
    AllChem.Compute2DCoords(rdkit_mol)

    # 可视化分子
    return Draw.MolToImage(rdkit_mol)

# 可视化两个分子
img1 = visualize_molecule_from_xyz('new_c4c1im.xyz')
img2 = visualize_molecule_from_xyz('new_ntf2.xyz')

# 将图像转换为可显示的格式
bio1 = io.BytesIO()
bio2 = io.BytesIO()
img1.save(bio1, format='PNG')
img2.save(bio2, format='PNG')

image_widget1 = widgets.Image(value=bio1.getvalue(), format='png', width=200, height=200)
image_widget2 = widgets.Image(value=bio2.getvalue(), format='png', width=200, height=200)

# 使用 HBox 布局并排显示
hbox = widgets.HBox([image_widget1, image_widget2])
display(hbox)
```

    ==============================
    *** Open Babel Warning  in PerceiveBondOrders
      Failed to kekulize aromatic bonds in OBMol::PerceiveBondOrders (title is INSERT TITLE CARD HERE)
    



    HBox(children=(Image(value=b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01,\x00\x00\x01,\x08\x02\x00\x00\x00…



```python
import py3Dmol

# 读取.xyz文件
with open('./simbox.xyz', 'r') as file:
    xyz_data = file.read()

# 设置视图
# 创建视图
view = py3Dmol.view(width=800, height=400)
# 添加分子模型
view.addModel(xyz_data, "xyz")
# 设置分子的显示风格
view.setStyle({'stick': {}})
# 调整视图
view.zoomTo()
# 显示视图
view.show()
```


<div id="3dmolviewer_170067047707064"  style="position: relative; width: 800px; height: 400px;">
        <p id="3dmolwarning_170067047707064" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js');
}

var viewer_170067047707064 = null;
var warn = document.getElementById("3dmolwarning_170067047707064");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_170067047707064 = $3Dmol.createViewer(document.getElementById("3dmolviewer_170067047707064"),{backgroundColor:"white"});
viewer_170067047707064.zoomTo();
	viewer_170067047707064.addModel("         800\n  Built with Packmol                                             \n  N           11.189034       13.276114        9.363471\n  C           10.081677       12.679285        9.746590\n  N            9.164365       12.799979        8.812141\n  C            9.711141       13.514554        7.768445\n  C           10.972953       13.811290        8.112044\n  C           12.438876       13.363228       10.124696\n  H            9.945955       12.166858       10.687546\n  C            7.798222       12.270668        8.863527\n  H            9.216553       13.784754        6.847156\n  H           11.685884       14.365458        7.519570\n  H           12.683851       14.410204       10.303378\n  H           12.320073       12.850407       11.079160\n  H           13.243305       12.893935        9.558341\n  C            7.583499       11.539979       10.189359\n  H            7.086433       13.092194        8.782594\n  H            7.645887       11.575925        8.037558\n  C            6.158649       10.987921       10.242954\n  H            8.294459       10.717803       10.270991\n  H            7.735005       12.234072       11.016027\n  C            5.943926       10.257232       11.568786\n  H            6.006313       10.293178        9.416984\n  H            5.446859       11.809448       10.162020\n  H            4.928173        9.863679       11.606993\n  H            6.095432       10.951326       12.395454\n  H            6.654886        9.435057       11.650418\n  N           22.757761       15.619938       25.632097\n  C           22.842218       14.308849       25.576072\n  N           21.636152       13.784978       25.562299\n  C           20.723400       14.816128       25.612241\n  C           21.422407       15.959709       25.655740\n  C           23.879164       16.563645       25.664210\n  H           23.763858       13.746649       25.545897\n  C           21.310932       12.356689       25.504164\n  H           19.647589       14.721160       25.615698\n  H           21.015528       16.959117       25.700826\n  H           23.832781       17.152816       26.580085\n  H           24.819249       16.012782       25.634387\n  H           23.820430       17.227998       24.802070\n  C           22.603056       11.540377       25.460671\n  H           20.735465       12.078331       26.387031\n  H           20.723114       12.153513       24.609017\n  C           22.263861       10.050709       25.400038\n  H           23.179006       11.817567       24.577751\n  H           23.191357       11.742385       26.355765\n  C           23.555985        9.234397       25.356545\n  H           21.676042        9.847533       24.504891\n  H           21.688393        9.772351       26.282905\n  H           23.314177        8.172437       25.313320\n  H           24.144286        9.436406       26.251639\n  H           24.131934        9.511587       24.473625\n  N           10.104719       18.828101        2.391636\n  C            9.001636       19.543944        2.391424\n  N            7.954457       18.748557        2.390034\n  C            8.408057       17.447354        2.389310\n  C            9.748140       17.496927        2.390309\n  C           11.476944       19.344003        2.393032\n  H            8.961711       20.623206        2.392264\n  C            6.548693       19.164469        2.389364\n  H            7.798960       16.555503        2.388157\n  H           10.421467       16.652515        2.390110\n  H           11.998947       18.991885        1.503298\n  H           11.455937       20.433800        2.393895\n  H           11.997674       18.990452        3.282943\n  C            6.468176       20.691347        2.390536\n  H            6.054680       18.775781        1.498874\n  H            6.053407       18.774348        3.278519\n  C            5.002001       21.125132        2.389837\n  H            6.961406       21.081028        3.281026\n  H            6.962679       21.082461        1.501381\n  C            4.921484       22.652011        2.391010\n  H            4.506715       20.735010        3.278992\n  H            4.507987       20.736444        1.499348\n  H            3.876271       22.961248        2.390511\n  H            5.415987       23.043125        1.501855\n  H            5.414715       23.041691        3.281500\n  N            3.140761        2.888840       23.565799\n  C            4.429690        3.002581       23.800216\n  N            4.701611        2.572186       25.012669\n  C            3.521946        2.157908       25.592019\n  C            2.549195        2.355253       24.690303\n  C            2.444802        3.260699       22.330275\n  H            5.155997        3.391182       23.101740\n  C            6.023952        2.535962       25.644540\n  H            3.403170        1.750900       26.585315\n  H            1.499524        2.137099       24.820680\n  H            1.695644        4.021483       22.549522\n  H            3.163723        3.655676       21.612469\n  H            1.956846        2.381816       21.908894\n  C            7.069509        3.082517       24.671951\n  H            6.012962        3.147494       26.546763\n  H            6.274164        1.507827       25.906135\n  C            8.448675        3.044737       25.330975\n  H            7.081726        2.471243       23.769569\n  H            6.820524        4.110910       24.410197\n  C            9.494232        3.591293       24.358385\n  H            8.698887        2.016602       25.592570\n  H            8.437685        3.656269       26.233198\n  H           10.477417        3.564359       24.828193\n  H            9.245247        4.619685       24.096631\n  H            9.506449        2.980018       23.456003\n  N            6.901401       23.607985       25.699289\n  C            7.359852       22.375924       25.666507\n  N            6.356949       21.526282       25.705438\n  C            5.186730       22.251342       25.766739\n  C            5.526042       23.548698       25.762906\n  C            7.702378       24.835550       25.673273\n  H            8.403495       22.102817       25.615291\n  C            6.457234       20.063829       25.687235\n  H            4.184892       21.850256       25.809769\n  H            4.848919       24.389147       25.802269\n  H            7.513028       25.412802       26.578274\n  H            8.760401       24.578624       25.621536\n  H            7.430094       25.429241       24.800637\n  C            7.928502       19.653992       25.614805\n  H            6.011615       19.657239       26.595094\n  H            5.928682       19.673678       24.817457\n  C            8.033098       18.128692       25.595819\n  H            8.374920       20.059602       24.706900\n  H            8.457853       20.043163       26.484537\n  C            9.504366       17.718855       25.523389\n  H            7.504545       17.738541       24.726042\n  H            7.587478       17.722102       26.503678\n  H            9.578931       16.631493       25.509855\n  H           10.033717       18.108027       26.393121\n  H            9.950784       18.124466       24.615484\n  N            3.469953       15.542717       25.246481\n  C            3.640487       14.239217       25.278567\n  N            4.847077       13.937196       24.851778\n  C            5.490092       15.111751       24.526453\n  C            4.631843       16.112341       24.772439\n  C            2.261663       16.272313       25.642564\n  H            2.900576       13.523998       25.606278\n  C            5.415971       12.590812       24.738794\n  H            6.495919       15.208286       24.145150\n  H            4.816349       17.166414       24.626537\n  H            1.881770       16.836618       24.790895\n  H            1.502669       15.564982       25.976797\n  H            2.500886       16.958577       26.454915\n  C            4.383948       11.560453       25.198285\n  H            5.686061       12.395853       23.700940\n  H            6.305177       12.517811       25.364960\n  C            4.977289       10.156209       25.080446\n  H            4.113636       11.754179       26.236313\n  H            3.494520       11.632221       24.572293\n  C            3.945266        9.125850       25.539937\n  H            5.866496       10.083209       25.706611\n  H            5.247380        9.961250       24.042591\n  H            4.368250        8.124787       25.455931\n  H            3.055838        9.197618       24.913945\n  H            3.674954        9.319577       26.577964\n  N           11.961263       13.770905       19.649374\n  C           11.536221       12.863770       20.501237\n  N           11.276776       13.428075       21.660319\n  C           11.549893       14.774160       21.549212\n  C           11.976478       14.987818       20.295953\n  C           12.352650       13.540152       18.255557\n  H           11.417958       11.812924       20.281833\n  C           10.783583       12.751730       22.863845\n  H           11.440906       15.517202       22.325362\n  H           12.275721       15.935324       19.872769\n  H           13.392913       13.834346       18.116267\n  H           12.239449       12.482817       18.016124\n  H           11.717005       14.131480       17.596476\n  C           10.608534       11.260362       22.575709\n  H           11.500322       12.882953       23.674502\n  H            9.824413       13.180087       23.154711\n  C           10.094147       10.554951       23.830955\n  H            9.891446       11.128026       21.765541\n  H           11.567355       10.830892       22.285332\n  C            9.919098        9.063584       23.542819\n  H            9.134977       10.983309       24.121821\n  H           10.810886       10.686176       24.641612\n  H            9.552400        8.560708       24.437663\n  H           10.877919        8.634114       23.252441\n  H            9.202011        8.931247       22.732651\n  N           15.397673       17.053296       25.406783\n  C           16.459347       17.826752       25.468753\n  N           16.089482       19.087591       25.520808\n  C           14.712434       19.128997       25.490700\n  C           14.281286       17.861187       25.419638\n  C           15.390666       15.589015       25.336153\n  H           17.481696       17.478681       25.475834\n  C           16.978835       20.250487       25.597502\n  H           14.096380       20.015606       25.519006\n  H           13.252635       17.534536       25.379939\n  H           14.896045       15.271381       24.418243\n  H           16.416116       15.219535       25.342276\n  H           14.854619       15.185859       26.195350\n  C           18.433759       19.780476       25.608799\n  H           16.812047       20.893711       24.733474\n  H           16.770621       20.808190       26.510581\n  C           19.361330       20.993346       25.688789\n  H           18.601753       19.137628       26.472873\n  H           18.643179       19.223149       24.695766\n  C           20.816254       20.523335       25.700086\n  H           19.153116       21.551049       26.601869\n  H           19.194542       21.636570       24.824761\n  H           21.477505       21.387971       25.757110\n  H           21.025674       19.966008       24.787053\n  H           20.984248       19.880487       26.564160\n  N           20.152614       21.504308        4.478921\n  C           21.082855       22.399541        4.229052\n  N           20.796064       23.041726        3.117938\n  C           19.614944       22.531831        2.624132\n  C           19.213933       21.573683        3.472322\n  C           20.110920       20.588674        5.623050\n  H           21.952011       22.580259        4.844120\n  C           21.587865       24.112718        2.505415\n  H           19.107694       22.844926        1.723539\n  H           18.322927       20.969858        3.383424\n  H           20.116008       19.559024        5.265427\n  H           20.982217       20.757250        6.255920\n  H           19.203492       20.767988        6.199695\n  C           22.825395       24.385695        3.360893\n  H           21.897793       23.809653        1.505317\n  H           20.985277       25.018617        2.439586\n  C           23.651222       25.502712        2.722049\n  H           22.516511       24.689464        4.361101\n  H           23.429028       23.480500        3.426832\n  C           24.888753       25.775689        3.577527\n  H           23.048634       26.408612        2.656219\n  H           23.961150       25.199647        1.721950\n  H           25.477471       26.571993        3.122105\n  H           25.492385       24.870494        3.643466\n  H           24.579869       26.079458        4.577735\n  N            9.957594       25.673970        4.967184\n  C           11.181004       25.657787        4.485281\n  N           11.142254       25.671965        3.170929\n  C            9.819915       25.698785        2.784168\n  C            9.081613       25.700035        3.903627\n  C            9.580065       25.665935        6.383717\n  H           12.082390       25.636104        5.079784\n  C           12.297481       25.661282        2.268435\n  H            9.448130       25.715628        1.770318\n  H            8.003293       25.718074        3.961070\n  H            8.974663       24.784231        6.593921\n  H           10.479032       25.644073        6.999737\n  H            9.005403       26.563517        6.612208\n  C           13.586674       25.630566        3.089945\n  H           12.252665       24.778609        1.630485\n  H           12.283405       26.557896        1.648771\n  C           14.791546       25.619424        2.148669\n  H           13.632753       26.513217        3.727835\n  H           13.602013       24.733930        3.709549\n  C           16.080740       25.588708        2.970178\n  H           14.777470       26.516038        1.529004\n  H           14.746730       24.736752        1.510718\n  H           16.939673       25.580765        2.299157\n  H           16.096078       24.692073        3.589782\n  H           16.126818       26.471359        3.608069\n  N           10.800268        5.102294        2.388153\n  C            9.594334        4.577942        2.389531\n  N            9.679173        3.265703        2.382015\n  C           11.014463        2.925349        2.375424\n  C           11.713150        4.069946        2.379250\n  C           11.127929        6.531192        2.394853\n  H            8.672513        5.140620        2.395883\n  C            8.556145        2.323386        2.380801\n  H           11.421641        1.925070        2.368484\n  H           12.788953        4.165016        2.375971\n  H           11.706847        6.775914        1.504311\n  H           10.207771        7.115460        2.401318\n  H           11.713136        6.766127        3.283919\n  C            7.238734        3.099394        2.389725\n  H            8.604491        1.700864        1.487365\n  H            8.610780        1.691077        3.266973\n  C            6.067444        2.116583        2.388459\n  H            7.189128        3.721812        3.283165\n  H            7.182839        3.731599        1.503557\n  C            4.750033        2.892592        2.397382\n  H            6.122080        1.484273        3.274631\n  H            6.115791        1.494060        1.495023\n  H            3.915039        2.191960        2.396480\n  H            4.694138        3.524796        1.511215\n  H            4.700427        3.515009        3.290823\n  N            4.845994       10.306775        2.373996\n  C            4.396578       11.542577        2.380609\n  N            3.081590       11.538331        2.384252\n  C            2.659984       10.226420        2.379735\n  C            3.759594        9.458891        2.373343\n  C            6.252127        9.892149        2.368282\n  H            5.014736       12.428172        2.382730\n  C            2.209905       12.717002        2.391793\n  H            1.636605        9.881321        2.381087\n  H            3.788511        8.379289        2.368579\n  H            6.453333        9.300343        1.475319\n  H            6.891732       10.774760        2.370330\n  H            6.458289        9.292623        3.254941\n  C            3.065255       13.984365        2.394910\n  H            1.578028       12.707926        1.503679\n  H            1.582983       12.700205        3.283301\n  C            2.156111       15.213688        2.402775\n  H            3.697105       13.994705        3.283030\n  H            3.692150       14.002426        1.503408\n  C            3.011460       16.481052        2.405891\n  H            1.529188       15.196891        3.294283\n  H            1.524233       15.204612        1.514660\n  H            2.363346       17.357416        2.411498\n  H            3.638356       16.499112        1.514389\n  H            3.643311       16.491392        3.294012\n  N            2.370861        8.496884       11.280482\n  C            2.401126        9.367396       10.295334\n  N            2.383639        8.735774        9.142089\n  C            2.339644        7.382530        9.398364\n  C            2.331680        7.233649       10.731050\n  C            2.377282        8.804232       12.713888\n  H            2.435228       10.440162       10.415381\n  C            2.406655        9.354493        7.813250\n  H            2.316023        6.590861        8.664129\n  H            2.300438        6.299505       11.272159\n  H            3.251886        8.349951       13.179500\n  H            2.411580        9.884619       12.854203\n  H            1.473159        8.406972       13.175242\n  C            2.455072       10.875730        7.959317\n  H            3.287329        9.014092        7.268604\n  H            1.508602        9.071113        7.264346\n  C            2.479077       11.521039        6.573374\n  H            1.574434       11.217229        8.503336\n  H            3.353161       11.160207        8.507595\n  C            2.527494       13.042276        6.719441\n  H            1.581024       11.237658        6.024469\n  H            3.359751       11.180636        6.028727\n  H            2.544607       13.502305        5.731423\n  H            3.425584       13.326753        7.267718\n  H            1.646857       13.383774        7.263459\n  N            2.399076       11.448753       19.376755\n  C            2.396951       12.736139       19.108689\n  N            2.392078       13.424435       20.229157\n  C            2.391003       12.530633       21.277966\n  C            2.395364       11.299351       20.746733\n  C            2.404443       10.356293       18.399177\n  H            2.398914       13.163985       18.117052\n  C            2.388409       14.885422       20.350239\n  H            2.387337       12.775635       22.329802\n  H            2.395873       10.366051       21.290194\n  H            1.515603        9.740554       18.536758\n  H            2.406486       10.770317       17.390871\n  H            3.295236        9.744588       18.542020\n  C            2.391109       15.513118       18.956025\n  H            1.496263       15.203576       20.889640\n  H            3.275897       15.207609       20.894903\n  C            2.387282       17.036889       19.082308\n  H            3.283253       15.196053       18.415980\n  H            1.503620       15.192020       18.410718\n  C            2.389981       17.664585       17.688095\n  H            3.274770       17.359076       19.626973\n  H            1.495136       17.355043       19.621711\n  H            2.387253       18.750857       17.778121\n  H            1.502492       17.343487       17.142788\n  H            3.282126       17.347520       17.148050\n  N           10.965334       24.452123       14.762269\n  C           12.219793       24.568041       15.139255\n  N           12.281086       25.182992       16.299989\n  C           10.994150       25.479988       16.693019\n  C           10.174149       25.024497       15.734683\n  C           10.481892       23.826480       13.527760\n  H           13.071907       24.211652       14.579532\n  C           13.499630       25.500631       17.050598\n  H           10.701090       25.984604       17.601797\n  H            9.096370       25.093221       15.726360\n  H            9.931080       24.560372       12.939451\n  H           11.329963       23.460293       12.949155\n  H            9.824676       22.992935       13.775489\n  C           14.720539       25.004296       16.275436\n  H           13.571298       26.579517       17.188321\n  H           13.464894       25.012080       18.024359\n  C           15.991448       25.335585       17.058301\n  H           14.650132       23.925326       16.137716\n  H           14.756536       25.492763       15.301679\n  C           17.212357       24.839250       16.283139\n  H           15.956712       24.847034       18.032063\n  H           16.063116       26.414472       17.196025\n  H           18.118368       25.075421       16.841232\n  H           17.248354       25.327717       15.309382\n  H           17.141951       23.760280       16.145420\n  N           25.707283       11.528618        9.677151\n  C           25.613301       11.597823       10.986962\n  N           25.707507       10.392668       11.504601\n  C           25.871364        9.496692       10.470551\n  C           25.871225       10.204637        9.331650\n  C           25.649296       12.654319        8.739819\n  H           25.478904       12.507922       11.552699\n  C           25.649463       10.053190       12.929572\n  H           25.979536        8.425889       10.560434\n  H           25.979263        9.811318        8.331636\n  H           24.812612       12.515030        8.055233\n  H           25.513674       13.582887        9.294319\n  H           26.578425       12.703212        8.171992\n  C           25.459219       11.328815       13.750808\n  H           24.812759        9.378029       13.108970\n  H           26.578572        9.566211       13.225728\n  C           25.398681       10.974749       15.237015\n  H           26.295796       12.004443       13.572579\n  H           24.529983       11.816261       13.455820\n  C           25.208436       12.250375       16.058251\n  H           26.327789       10.487770       15.533171\n  H           24.561976       10.299588       15.416413\n  H           25.165279       11.997966       17.117745\n  H           24.279200       12.737820       15.763263\n  H           26.045013       12.926003       15.880022\n  N            9.402475       23.213617       21.279102\n  C            8.837656       22.031503       21.165918\n  N            9.758910       21.093465       21.190406\n  C           10.986064       21.705280       21.327011\n  C           10.763926       23.026597       21.382288\n  C            8.715388       24.508547       21.294098\n  H            7.776359       21.857193       21.067598\n  C            9.529574       19.648961       21.090564\n  H           11.946034       21.213258       21.379648\n  H           11.511317       23.799041       21.487823\n  H            9.070568       25.118539       20.463521\n  H            7.641237       24.351662       21.195678\n  H            8.922772       25.019614       22.234259\n  C            8.031217       19.378549       20.950396\n  H           10.052169       19.257038       20.217988\n  H            9.904374       19.158112       21.988725\n  C            7.792025       17.871969       20.846264\n  H            7.507742       19.769573       21.822849\n  H            7.655538       19.868498       20.052112\n  C            6.293668       17.601558       20.706096\n  H            8.166826       17.381121       21.744425\n  H            8.314621       17.480046       19.973688\n  H            6.123152       16.527541       20.631862\n  H            5.917988       18.091507       19.807812\n  H            5.770193       17.992581       21.578549\n  N           23.695350       17.750647        2.396948\n  C           23.363767       16.478142        2.393819\n  N           24.448722       15.735111        2.395388\n  C           25.540568       16.575787        2.399772\n  C           25.071053       17.831907        2.400745\n  C           22.773154       18.890257        2.396513\n  H           22.352131       16.100013        2.390465\n  C           24.497198       14.269915        2.392927\n  H           26.578960       16.278909        2.402005\n  H           25.660131       18.737101        2.403908\n  H           22.945993       19.497841        1.508218\n  H           21.745556       18.526760        2.393142\n  H           22.941268       19.494697        3.287855\n  C           23.073569       13.712151        2.388162\n  H           25.025048       13.924822        1.503892\n  H           25.020323       13.921678        3.283529\n  C           23.124127       12.183990        2.385596\n  H           22.545023       14.056188        3.277193\n  H           22.549748       14.059332        1.497557\n  C           21.700498       11.626227        2.380830\n  H           23.647253       11.835753        3.276197\n  H           23.651979       11.838897        1.496560\n  H           21.736541       10.536825        2.379001\n  H           21.176678       11.973408        1.490225\n  H           21.171952       11.970264        3.269862\n  N            3.320924        4.850040        5.261953\n  C            4.243411        4.459501        6.113847\n  N            3.925521        3.282218        6.605959\n  C            2.731385        2.892247        6.039528\n  C            2.354589        3.869343        5.201918\n  C            3.311512        6.104921        4.504099\n  H            5.129240        5.021363        6.370789\n  C            4.699451        2.513097        7.585063\n  H            2.199138        1.972772        6.233635\n  H            1.461758        3.884922        4.594456\n  H            2.420375        6.677969        4.760205\n  H            4.199981        6.685955        4.751328\n  H            3.307172        5.885192        3.436485\n  C            5.960148        3.290951        7.963782\n  H            4.094812        2.345892        8.476440\n  H            4.981609        1.553116        7.152720\n  C            6.767337        2.488780        8.984961\n  H            6.565834        3.458145        7.073113\n  H            5.679037        4.250922        8.396834\n  C            8.028034        3.266634        9.363680\n  H            7.049494        1.528797        8.552618\n  H            6.162697        2.321574        9.876338\n  H            8.603465        2.694778       10.091663\n  H            7.746923        4.226604        9.796732\n  H            8.633720        3.433827        8.473012\n  N           25.091584        2.703124       19.462839\n  C           23.778040        2.763177       19.477741\n  N           23.356440        2.991596       20.702201\n  C           24.460004        3.083911       21.522266\n  C           25.541378        2.904130       20.749873\n  C           25.938604        2.464975       18.290236\n  H           23.141049        2.642936       18.613921\n  C           21.960223        3.125811       21.128490\n  H           24.454961        3.266652       22.586681\n  H           26.571180        2.914826       21.075129\n  H           26.529201        1.562069       18.445335\n  H           25.311375        2.341054       17.407441\n  H           26.605909        3.314484       18.144840\n  C           21.039153        2.958822       19.919529\n  H           21.730383        2.359091       21.868365\n  H           21.807091        4.111506       21.567869\n  C           19.582936        3.098804       20.364138\n  H           21.267791        3.725527       19.179267\n  H           21.191082        1.973112       19.479763\n  C           18.661867        2.931815       19.155176\n  H           19.429804        4.084500       20.803517\n  H           19.353096        2.332085       21.104013\n  H           17.623753        3.031606       19.472131\n  H           18.813796        1.946106       18.715410\n  H           18.890504        3.698521       18.414915\n  C           15.022331       21.081189        6.552353\n  F           15.230412       19.927061        5.920755\n  F           13.710562       21.183099        6.759957\n  F           15.700372       21.028689        7.697660\n  S           15.594859       22.500563        5.571172\n  N           15.185983       23.822848        6.558280\n  O           17.008208       22.241710        5.438170\n  O           14.825968       22.374308        4.356630\n  S           16.298716       24.403957        7.704638\n  O           17.039274       23.216012        8.054797\n  O           15.440096       24.925345        8.740579\n  C           17.226213       25.650424        6.760609\n  F           16.348816       26.566206        6.353491\n  F           17.794542       25.020896        5.733516\n  F           18.134727       26.169772        7.584686\n  C            6.488163       14.713665       17.852550\n  F            5.899273       15.904327       17.951327\n  F            7.802854       14.927087       17.836366\n  F            6.116789       14.003564       18.916533\n  S            5.995105       13.840308       16.336216\n  N            6.896121       12.401600       16.427264\n  O            4.570386       13.689801       16.508767\n  O            6.398905       14.758368       15.298739\n  S            6.242959       11.037274       17.203144\n  O            5.384193       11.624761       18.202960\n  O            7.418030       10.371346       17.711079\n  C            5.387334       10.181269       15.846574\n  F            6.305984        9.886763       14.928110\n  F            4.467308       11.019903       15.372792\n  F            4.835716        9.083901       16.362057\n  C           25.458640       23.493601       24.643054\n  F           25.637965       24.212880       25.749718\n  F           26.474217       23.770737       23.826952\n  F           25.452815       22.211910       25.005625\n  S           23.889121       23.900097       23.820559\n  N           23.920534       22.899643       22.446475\n  O           22.909578       23.547795       24.819873\n  O           24.026731       25.312758       23.560364\n  S           23.261943       21.334109       22.519656\n  O           23.466984       20.970604       23.900987\n  O           24.064593       20.609950       21.563835\n  C           21.531457       21.608779       22.034787\n  F           21.546035       22.127102       20.807858\n  F           21.005771       22.453148       22.920744\n  F           20.924140       20.423609       22.062384\n  C           25.401270       16.587319       13.518413\n  F           24.805398       16.432845       14.699640\n  F           26.589353       15.990374       13.598025\n  F           24.619588       16.010637       12.607022\n  S           25.629077       18.342144       13.101494\n  N           26.428845       18.266560       11.603275\n  O           24.272998       18.833166       13.054630\n  O           26.424627       18.826804       14.203516\n  S           25.530034       18.232608       10.160713\n  O           24.312450       17.571445       10.563953\n  O           26.382032       17.474346        9.276752\n  C           25.361588       19.997143        9.756778\n  F           26.592473       20.484527        9.609790\n  F           24.721481       20.572308       10.773474\n  F           24.661943       20.075027        8.626002\n  C           18.110072       10.679181       19.774367\n  F           17.515414       11.870707       19.803906\n  F           17.614794       10.020101       18.728165\n  F           19.417819       10.897188       19.645932\n  S           17.797922        9.730984       21.293778\n  N           18.611444        8.269037       20.992294\n  O           18.385346       10.566937       22.312780\n  O           16.357818        9.643436       21.319926\n  S           20.241994        8.095477       21.440826\n  O           20.744567        9.443457       21.328487\n  O           20.741663        7.165132       20.457444\n  C           20.120445        7.447842       23.135204\n  F           19.457812        6.294372       23.067020\n  F           19.460439        8.354075       23.854480\n  F           21.364525        7.276509       23.579200\n  C           23.000933       19.195509       18.294638\n  F           24.155669       19.636385       18.791061\n  F           22.038246       19.605660       19.118794\n  F           22.869108       19.725452       17.079727\n  S           22.966446       17.381841       18.174035\n  N           21.407692       17.080160       17.566354\n  O           24.049975       17.106372       17.261713\n  O           23.188111       16.971294       19.539526\n  S           21.148525       17.010851       15.887657\n  O           22.153807       17.911067       15.376512\n  O           19.786013       17.468668       15.760332\n  C           21.417213       15.251393       15.517202\n  F           20.525271       14.561255       16.225988\n  F           22.665859       14.961204       15.878998\n  F           21.234161       15.094568       14.207194\n  C            2.667334       25.356849       19.348077\n  F            3.205372       26.571211       19.247760\n  F            1.507105       25.387308       18.694499\n  F            3.524182       24.501706       18.792407\n  S            2.377348       24.887889       21.080448\n  N            1.664248       23.351610       20.934377\n  O            3.708509       24.901467       21.637291\n  O            1.500851       25.934744       21.547456\n  S            2.640211       21.959799       20.915565\n  O            3.864945       22.442113       20.324252\n  O            1.875038       21.049815       20.097831\n  C            2.744259       21.524541       22.677623\n  F            1.500872       21.301376       23.100014\n  F            3.299833       22.560073       23.304707\n  F            3.499315       20.430865       22.766978\n  C           15.375305        5.986720        2.730069\n  F           15.583690        4.854331        3.399766\n  F           14.938553        5.649991        1.517598\n  F           14.462478        6.680433        3.408105\n  S           16.896566        6.970321        2.577036\n  N           16.381357        8.311117        1.667736\n  O           17.231652        7.247938        3.952862\n  O           17.789005        6.065526        1.893555\n  S           15.787342        9.695203        2.456056\n  O           15.206670        9.147851        3.658336\n  O           14.845163       10.222680        1.498813\n  C           17.290218       10.688903        2.699054\n  F           17.796122       10.935545        1.491803\n  F           18.122939        9.963854        3.444105\n  F           16.922911       11.809545        3.318303\n  C           13.885085        2.763703       20.387616\n  F           15.029324        3.442593       20.451261\n  F           14.180876        1.478911       20.577459\n  F           13.095552        3.235662       21.351004\n  S           13.067562        2.967967       18.776698\n  N           11.685192        1.991385       18.935891\n  O           12.818962        4.388548       18.727743\n  O           14.064896        2.482433       17.853752\n  S           10.241978        2.653600       19.543017\n  O           10.718571        3.688005       20.429085\n  O            9.623844        1.521475       20.189897\n  C            9.410260        3.240170       18.036596\n  F            9.224886        2.179045       17.253093\n  F           10.214565        4.137681       17.469329\n  F            8.253786        3.782886       18.413755\n  C           20.135968       19.331968       11.277974\n  F           20.198838       18.015573       11.084645\n  F           18.847879       19.649076       11.398360\n  F           20.815460       19.597037       12.392538\n  S           20.862004       20.253733        9.889324\n  N           20.623585       21.871753       10.353185\n  O           22.233156       19.804122        9.895660\n  O           20.070358       19.808732        8.767933\n  S           21.809812       22.677982       11.265797\n  O           22.408075       21.604846       12.022574\n  O           21.030423       23.617656       12.035091\n  C           22.868195       23.410367        9.981835\n  F           22.101176       24.225965        9.260234\n  F           23.346633       22.406298        9.248918\n  F           23.840816       24.072185       10.606519\n  C            4.904947       20.518085       13.115803\n  F            5.106834       19.910971       11.947523\n  F            4.864398       19.568372       14.048876\n  F            5.925868       21.352391       13.305215\n  S            3.345354       21.452203       13.130626\n  N            3.305442       22.082260       14.709054\n  O            3.549645       22.422552       12.082323\n  O            2.364829       20.432265       12.846822\n  S            4.000624       23.598599       15.036827\n  O            5.065601       23.673113       14.065992\n  O            4.423599       23.460861       16.409551\n  C            2.612519       24.739474       14.759891\n  F            1.647899       24.396809       15.612132\n  F            2.228297       24.588694       13.493455\n  F            3.064219       25.970273       14.995103\n  C           15.754654        2.805170       24.010281\n  F           14.615481        3.495464       24.008841\n  F           15.429839        1.513381       24.010670\n  F           16.420541        3.146010       22.908171\n  S           16.768083        3.177882       25.472873\n  N           18.113931        2.161255       25.260361\n  O           17.029297        4.589161       25.323513\n  O           15.890895        2.823142       26.562345\n  S           19.473979        2.718886       24.406363\n  O           18.896665        3.653224       23.470429\n  O           19.999777        1.506982       23.825783\n  C           20.490720        3.458850       25.719304\n  F           20.766136        2.492074       26.593214\n  F           19.768876        4.432369       26.271957\n  F           21.594274        3.930348       25.141306\n  C           12.274367       10.374405        5.198591\n  F           11.586787        9.591226        6.028102\n  F           12.543329        9.653085        4.111586\n  F           11.500624       11.421375        4.916812\n  S           13.828271       10.950262        5.946184\n  N           14.520080       11.874375        4.698220\n  O           13.368307       11.700861        7.089550\n  O           14.508169        9.714378        6.250450\n  S           14.177980       13.535446        4.580708\n  O           12.847217       13.622520        5.131833\n  O           14.276771       13.777555        3.161598\n  C           15.490687       14.283225        5.592018\n  F           16.653681       13.935597        5.043541\n  F           15.361302       13.795439        6.824717\n  F           15.305491       15.601932        5.561412\n  C           10.409886       17.840289       15.250412\n  F            9.996739       17.635009       16.499969\n  F           10.951773       19.056471       15.211872\n  F           11.304077       16.892850       14.972912\n  S            9.037383       17.748083       14.061775\n  N            9.805597       18.079212       12.581842\n  O            8.569202       16.393065       14.226039\n  O            8.140553       18.774135       14.536287\n  S           10.448431       16.807594       11.654614\n  O           10.813164       15.838391       12.659535\n  O           11.553401       17.440377       10.975737\n  C            9.046679       16.341490       10.594916\n  F            8.722938       17.416630        9.878332\n  F            8.053733       15.968366       11.400558\n  F            9.457404       15.338230        9.820966\n  C           25.316070       25.389155       18.016213\n  F           26.536779       24.859992       18.080092\n  F           25.425666       26.550163       17.372573\n  F           24.549644       24.526656       17.350698\n  S           24.616396       25.674184       19.669797\n  N           23.108547       26.376301       19.318479\n  O           24.564685       24.342653       20.223512\n  O           25.584566       26.557796       20.273225\n  S           21.739037       25.390329       19.112814\n  O           22.305362       24.169646       18.591798\n  O           20.941692       26.149649       18.180117\n  C           21.071635       25.281551       20.800376\n  F           20.784673       26.522912       21.188838\n  F           22.017488       24.732904       21.561015\n  F           19.981397       24.518536       20.741957\n  C            2.671532       25.946599       10.164611\n  F            3.224988       26.029087       11.373374\n  F            1.501779       26.580802       10.225334\n  F            3.507465       26.534275        9.310166\n  S            2.402067       24.220418        9.661808\n  N            1.665204       24.388428        8.139045\n  O            3.741824       23.684681        9.644881\n  O            1.547804       23.716897       10.710117\n  S            2.621054       24.452988        6.734701\n  O            3.843072       25.053121        7.212991\n  O            1.830459       25.277994        5.853467\n  C            2.746473       22.702674        6.259524\n  F            1.506817       22.265480        6.044257\n  F            3.326306       22.062186        7.273324\n  F            3.487354       22.649116        5.153879\n  C           12.403048        7.791849       14.011358\n  F           13.530509        8.256408       13.475410\n  F           12.341232        8.257045       15.257951\n  F           11.398053        8.246617       13.264768\n  S           12.366924        5.974402       14.037960\n  N           10.878630        5.644038       14.790184\n  O           12.439952        5.637564       12.636726\n  O           13.538431        5.647608       14.814507\n  S            9.471455        5.472794       13.851816\n  O            9.737478        6.334520       12.725357\n  O            8.437406        5.929040       14.748939\n  C            9.454256        3.692469       13.484028\n  F            9.401457        3.052002       14.650750\n  F           10.576778        3.418573       12.821345\n  F            8.373415        3.456193       12.742286\n  C           18.726744        2.676022       11.371391\n  F           18.551918        3.235735       10.175406\n  F           19.335047        1.507929       11.172015\n  F           19.480555        3.508875       12.087175\n  S           17.145683        2.400385       12.225439\n  N           17.631773        1.656214       13.674551\n  O           16.624226        3.738907       12.362154\n  O           16.433270        1.550357       11.302309\n  S           17.990076        2.605108       15.038815\n  O           18.474631        3.830784       14.451299\n  O           18.983154        1.811823       15.722002\n  C           16.379206        2.724439       15.873068\n  F           15.998477        1.482794       16.169025\n  F           15.538751        3.308022       15.020256\n  F           16.559272        3.459624       16.969108\n  C           21.799542       14.061384        7.064580\n  F           22.599302       13.891662        6.013009\n  F           21.902258       12.966093        7.815586\n  F           22.227163       15.144622        7.711078\n  S           20.067423       14.295727        6.564607\n  N           19.267453       14.444341        8.057243\n  O           20.128555       15.500648        5.772978\n  O           19.785595       13.086386        5.829547\n  S           19.074473       15.975865        8.769417\n  O           20.234844       16.691441        8.296404\n  O           19.069344       15.668973       10.179395\n  C           17.483958       16.532820        8.087374\n  F           16.564032       15.646596        8.464958\n  F           17.617695       16.570951        6.762654\n  F           17.242184       17.740877        8.593702\n  C            3.994141        2.295212       18.770177\n  F            3.578999        1.603506       19.830094\n  F            4.607753        3.384669       19.229294\n  F            4.827687        1.508792       18.091230\n  S            2.609512        2.783366       17.697967\n  N            3.384860        3.667982       16.470656\n  O            2.062099        1.511425       17.292067\n  O            1.779560        3.557991       18.588688\n  S            3.943071        2.875010       15.074378\n  O            4.256648        1.555107       15.566085\n  O            5.078804        3.677588       14.689375\n  C            2.507788        2.971807       13.962750\n  F            2.243697        4.263897       13.775705\n  F            1.500433        2.345083       14.568288\n  F            2.851600        2.369003       12.825805\n","xyz");
	viewer_170067047707064.setStyle({"stick": {}});
	viewer_170067047707064.zoomTo();
viewer_170067047707064.render();
});
</script>


### 三、生成GROMACS输入文件


```python
# Use fftool to create input files for GROMACS (-g)
command = f"fftool {num_molecules1} {file_path1} {num_molecules2} {file_path2} -r {density} -g"

# 在 Jupyter Notebook 中执行命令fftool
!{command}
```

    density 3.000 mol/L  volume 22141.0 A^3
    molecule_file      species           nmol force_field      nbond source  charge
      ./data/c4c1im.zmat c4c1im+             20 il.ff               25 file   +1.0000
      ./data/ntf2.zmat tf2N-               20 il.ff               14 file   -1.0000
    gromacs files
      em.mdp
      npt-gas.mdp
      npt.mdp
      field.top
      config.pdb


### 四、运行MD模拟基于GROMACS


```python
import subprocess

# 定义一个函数来执行命令并捕获输出
def run_command(command):
    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    stdout, stderr = process.communicate()
    return stdout.decode(), stderr.decode()

# 执行 gmx_mpi editconf
stdout, stderr = run_command(['gmx', 'editconf', '-f', 'config.pdb', '-o', 'conf.gro'])

# 能量极小化
# 执行 gmx_mpi grompp
stdout, stderr = run_command(['gmx', 'grompp', '-f', 'em.mdp', '-c', 'conf.gro', '-p', 'field.top', '-o', 'em'])
# 执行 gmx_mpi mdrun
stdout, stderr = run_command(['gmx', 'mdrun', '-v', '-deffnm', 'em'])

# npt模拟 10ns
# 执行 gmx_mpi grompp
stdout, stderr = run_command(['gmx', 'grompp', '-f', 'npt.mdp', '-c', 'em.gro', '-p', 'field.top', '-o', 'npt'])
# 执行 gmx_mpi mdrun, 提交任务到超算中心
!sbatch sub.gromacs-cpu
```

    Submitted batch job 112635


### 五、MD模拟后处理分析


```python
### 待续
```
